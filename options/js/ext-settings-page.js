// Generated by CoffeeScript 1.10.0
define(function(require) {
  var collection, dataMaintain, getNowDate, iconStyles, init, showErrorInfo, utils;
  collection = require('common/js/collection');
  dataMaintain = require('js/data-maintain');
  utils = require('common/js/utils');
  iconStyles = ['colored', 'grey'];
  init = function() {
    var iconStyle;
    iconStyle = collection.getConfig('iconStyle');
    if (-1 === iconStyles.indexOf(iconStyle)) {
      iconStyle = 'colored';
    }
    $("#ext-iconstyle-switch input[value='" + iconStyle + "']").prop('checked', true);
  };
  $('#ext-iconstyle-switch input:radio').on('change', function(e) {
    collection.setConfig('iconStyle', this.value);
  });
  getNowDate = function() {
    var now;
    now = new Date;
    return now.getFullYear() + '-' + (now.getMonth() + 1) + '-' + now.getDate();
  };
  $('#backup-ext-data').on('click', function() {
    var extData;
    extData = dataMaintain.getExtData();
    return dataMaintain.save2File(extData, "my-webrequest-" + (getNowDate()) + ".json");
  });
  showErrorInfo = function(msg) {
    return dialog({
      title: utils.i18n('opt_errdlg_title'),
      content: msg,
      okValue: utils.i18n('ok_btn'),
      ok: function() {}
    }).showModal();
  };
  $('#restore-ext-data').on('change', function(e) {
    var files, me;
    files = e.target.files;
    me = this;
    if (files.length) {
      return dialog({
        title: utils.i18n('opt_errdlg_title'),
        content: utils.i18n('opt_restore_confirmtip'),
        okValue: utils.i18n('ok_btn'),
        cancelValue: utils.i18n('cancel_btn'),
        cancel: function() {
          return me.value = '';
        },
        ok: function() {
          collection.setRestoreStatus(true);
          return dataMaintain.readFile(files[0], function(content) {
            me.value = '';
            if (!dataMaintain.restoreExtData(content)) {
              collection.setRestoreStatus(false);
              showErrorInfo(utils.i18n('opt_restore_formarterr'));
              return;
            }
            setTimeout(function() {
              return init();
            }, 300);
            return dialog({
              content: utils.i18n('opt_restore_success'),
              width: 250
            }).show($(me).parents('a')[0]);
          }, function(msg) {
            me.value = '';
            return showErrorInfo(utils.i18n('opt_restore_readfail') + ': ' + msg);
          });
        }
      }).showModal();
    }
  });
  return {
    init: init
  };
});


//# sourceMappingURL=ext-settings-page.js.map
