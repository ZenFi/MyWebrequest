// Generated by CoffeeScript 1.10.0

/**
 * all rules gather together to be a collection
 */
(function(root, factory) {
  if (typeof define === 'function' && (define.amd || define.cmd)) {
    define(function() {
      return factory(root);
    });
  } else if (typeof exports === 'object') {
    module.exports = factory(root);
  } else {
    root.collection = factory(root);
  }
})(this, function(root) {
  var addRule, cats, collection, eachRule, getConfig, getLocal, getRules, getSwitch, hasCat, indexOfRule, initCollection, removeLocal, removeRule, saveCustomRule, saveRule, setConfig, setLocal, setSwitch;
  collection = {};
  cats = ['block', 'hsts', 'hotlink', 'log', 'custom'];
  hasCat = function(cat) {
    return ~cats.indexOf(cat);
  };
  getRules = function(cat) {
    var rules;
    rules = collection[cat];
    return rules.filter(function(rule) {
      return rule !== void 0;
    });
  };
  initCollection = function() {
    var cat, i, len;
    for (i = 0, len = cats.length; i < len; i++) {
      cat = cats[i];
      collection[cat] = JSON.parse(localStorage.getItem(cat) || '[]');
    }
  };
  indexOfRule = function(cat, rule) {
    var rules;
    rules = collection[cat];
    if (!(rules && rule)) {
      return -1;
    }
    return rules.indexOf(rule);
  };
  addRule = function(cat, rule) {
    var rules;
    if (!rule || ~indexOfRule(cat, rule)) {
      return false;
    }
    rules = collection[cat];
    rules[rules.length++] = rule;
    saveRule(cat);
    return true;
  };
  removeRule = function(cat, rules) {
    var _rules;
    _rules = collection[cat];
    if (rules === void 0 || (Array.isArray(rules) && _rules.length === rules.length)) {
      collection[cat] = [];
    } else {
      if (!Array.isArray(rules)) {
        rules = [rules];
      }
      rules.forEach(function(rule) {
        var index;
        index = indexOfRule(cat, rule);
        if (~index) {
          _rules[index] = void 0;
        }
      });
    }
    saveRule(cat);
  };
  saveRule = function(cat) {
    var arr;
    arr = getRules(cat);
    localStorage.setItem(cat, JSON.stringify(arr));
  };
  eachRule = function(cat, fn, context) {
    var rules;
    rules = collection[cat];
    if (!rules) {
      return;
    }
    rules.forEach(function(rule) {
      if (rule !== void 0) {
        fn.call(context, rule);
      }
    });
  };
  getSwitch = function(cat) {
    var onoff;
    onoff = JSON.parse(localStorage.getItem('onoff') || '{}');
    return !!onoff[cat];
  };
  setSwitch = function(cat, isOn) {
    var onoff;
    onoff = JSON.parse(localStorage.getItem('onoff') || '{}');
    onoff[cat] = !!isOn;
    localStorage.setItem('onoff', JSON.stringify(onoff));
  };
  getConfig = function(key) {
    var config;
    config = JSON.parse(localStorage.getItem('config') || '{}');
    return config[key];
  };
  setConfig = function(key, val) {
    var config;
    config = JSON.parse(localStorage.getItem('config') || '{}');
    config[key] = val;
    localStorage.setItem('config', JSON.stringify(config));
  };
  getLocal = function(key, expectFormat) {
    switch (expectFormat) {
      case 'object':
      case 'o':
        return JSON.parse(localStorage.getItem(key) || '{}');
      case 'array':
      case 'a':
        return JSON.parse(localStorage.getItem(key) || '[]');
      default:
        return localStorage.getItem(key);
    }
  };
  setLocal = function(key, val) {
    localStorage.setItem(key, JSON.stringify(val));
    initCollection();
  };
  removeLocal = function(key) {
    localStorage.removeItem(key);
    initCollection();
  };
  saveCustomRule = function(router) {};
  initCollection();
  return {
    _collection: collection,
    indexOfRule: indexOfRule,
    hasCat: hasCat,
    addRule: addRule,
    getRules: getRules,
    removeRule: removeRule,
    saveRule: saveRule,
    eachRule: eachRule,
    getLocal: getLocal,
    setLocal: setLocal,
    getSwitch: getSwitch,
    setSwitch: setSwitch,
    getConfig: getConfig,
    setConfig: setConfig
  };
});


//# sourceMappingURL=collection.js.map
